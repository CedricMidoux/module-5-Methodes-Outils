<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Bonnes pratiques en bioinformatique : (essayer) d’aller vers plus de reproductibilité</title>
    <meta charset="utf-8" />
    <meta name="author" content="Valentin Loux - Cédric Midoux - Olivier Rué" />
    <link href="slides_files/remark-css/default.css" rel="stylesheet" />
    <link href="slides_files/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/styles.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Bonnes pratiques en bioinformatique : (essayer) d’aller vers plus de reproductibilité
## DUBii - Module 5
### Valentin Loux - Cédric Midoux - Olivier Rué
### 2020/06/11

---




# Programme de l'après-midi
&lt;!--  14-17h --&gt;

- Intro : Reproductibilité, science ouverte &lt;!-- 25 mn) --&gt;

- Partie 1 : Organiser son espace de travail  &lt;!-- 5 mn --&gt;

- Partie 2 : Des langages à faible balisage pour faciliter la traçabilité et la prise de note &lt;!-- 30 mn --&gt;

- Partie 3 : Versionner ses documents &lt;!-- 45 mn --&gt;
  - TP

&lt;!-- 15h45 Pause --&gt;

- Partie 4 : Utilisation de documents computationels -- Notebook &lt;!-- 45 mn --&gt;
  - TP

- Conclusion et pour aller + loin &lt;!-- 15 mn --&gt;

---
# Tout le monde a déjà eu cette expérience

--
.pull-left[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/monnet-loux-plosone-2010.png" alt="Un Papier interessant" width="100%" /&gt;
&lt;p class="caption"&gt;Un Papier interessant&lt;/p&gt;
&lt;/div&gt;
]

--
.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/monnet-loux-plosone-mat-met.png" alt="Un materiel et méthode décevant" width="100%" /&gt;
&lt;p class="caption"&gt;Un materiel et méthode décevant&lt;/p&gt;
&lt;/div&gt;
]

--


---
# Crise de la reproductibilité

- Problème général ( "Reproducibility crisis")
  - Remis en avant par les science sociales ( pyschologie )
  - Etendu à l'ensemble des disciplines

Mais un problème qui n'est pas nouveau :
  - Experiences de la pompe à vide au XVIIe siècle (von Guericke et Boyle) 

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/Magdeburger-Halbkugeln.jpg" alt="Experiences des hemisphères de Magdebourg" width="50%" /&gt;
&lt;p class="caption"&gt;Experiences des hemisphères de Magdebourg&lt;/p&gt;
&lt;/div&gt;

???
Au XVIIe, experience de la pompe à vide par Otto van Guericke étaient basées sur des demonstrations spectaculaires, dans les cours d'europe qui lui assuraient notoriété. L'experience des hemisphères de Magdebourg qui consitait à essayer de fauire séparer des hémisphères de cuivre dans lésquel il avait fait lme vide, par des attelages de chevaux était très appréciée. Cela reposait sur un outillage et un savoir afire secret. Impossible à reproduire
Plus atrd, Boyle, sur le m^me sujet, consignait tout par écrit et avait recours à des témoins de bonne réputation (des gentlemen, à la base de la Royal Society) pour certifier ses expoeriences. c'est le début des publication scientifiques.
  
---
# Et en bioinfo ?

Un problème vieux comme la bioinformatique :

- En 2009, moins de la moitié des experiences de transcriptomique parues dans Nature Genetics n'ont pu être reproduites 
- Sur 50 articles citant BWA en 2011, 31 ne citent ni version, ni paramètres. 26 ne donnent pas accès aux données sous-jacentes
- Selon un sondage mené auprès de plus de 1500 biologistes
  - 70% ont déjà éprouvé des difficultés à reproduire une analyse ([Baker, 2016](https://doi.org/10.1038/533452a))

- [Ten Years Reproducibility Challenge](https://github.com/ReScience/ten-years) refaire ses analyses d'il y a 10 ans …

---
# Quelles sont les difficultés ?


- Problèmes **d'accès aux données** :
  - "data available upon request"
  - méta-données inexistantes ou insuffisantes
- Problèmes **d'accès aux outils** :
  - outils anciens ou obsolètes
  - difficultés à installer
- Problèmes de **paramètrage de l'analyse**
  - version des outil
  - paramètres des outils
  - enchainement des outils

- Problème d'accès aux **ressources necessaires**
  - calcul
  - stockage




---

# Réplication ≠ Reproductibilité

- La réplication indépendant d'analyse est à la base de la méthode scientifique

- En complément de **réplication** indépendante ( expérimentation, échantillonnage, analyse, …), la **reproduction** d'analyse est indispensable à l'évaluation et à la compréhension de la démarche employée

- Il existe une ambiguïté en anglais entre réplication (*réplication*) et reproduction (*reproducibility*). Derrière la *reproducibility crisis* on mélange les deux :
  - Impossibilité de répliquer des résultats de façon indépendante (psychologie, médecine, biologie…)
  - Impossibilité de reproduire des analyses à partir des mêmes données de départ

- Chacun peut déjà, par l'utilisation d'outils conviviaux, améliorer la reproductibilité de ses travaux


Source : ([Allard, 2018](https://laviedesidees.fr/La-crise-de-la-replicabilite.html)) 
&lt;!-- https://laviedesidees.fr/La-crise-de-la-replicabilite.html --&gt;

---
# En pratique, qu'est ce qu'être reproductible ?


&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="images/reproducible-data-analysis.png" alt="https://github.com/karthik/rstudio2019/blob/master/reproducible-data-analysis.pdff" width="80%" /&gt;
&lt;p class="caption"&gt;https://github.com/karthik/rstudio2019/blob/master/reproducible-data-analysis.pdff&lt;/p&gt;
&lt;/div&gt;

---
# En pratique, qu'est ce qu'être reproductible (2) ?

  Avoir accès :
  - aux pièces (les **données**)
  - aux outils ( les **logiciels**, )
  - au mode d'emploi : **paramètres**, **workflows d'analyse**
  
  Mais aussi :
  - à la description des pièces, de la façon dont elles ont été produites (**méta-données**)
  - à la documentation technique (**choix techniques explicites**)
  - au savoir faire du monteur (**formation**)
  - Éventuellement à un atelier équipé pour le montage (**ressources informatiques**)
  



---
# FAIR : un pré-requis la reproductibilité
.pull-left[
&lt;div class="figure" style="text-align: left"&gt;
&lt;img src="images/fair.png" alt="Findale Accessible Inetroprable Reusable " width="50%" /&gt;
&lt;p class="caption"&gt;Findale Accessible Inetroprable Reusable &lt;/p&gt;
&lt;/div&gt;
]
.pull-right[
Principes autour des données au sens large :
- **F**acile à trouver : pour les humains et les ordinateurs :
  - id unique et pérennes
  - métadonnées riches
- **A**ccessibles à ** long terme**
  - entrepôt "pérenne"
  - licence d'utilisation explicite ( FAIR ≠ ouvert)
- **I**nteroperables : faciles à combiner avec d'autres jeux de données
  - formats ouverts et documentés
  - vocabulaire standardisé, ontologies (données et méta-données)
- **R**éutilisables :
  - réutilisables par soi, par d'autres
  - réutilisables par des machines

]

([Wilkinson, Dumontier, Aalbersberg, et al., 2016](https://doi.org/10.1038/sdata.2016.18)) 

---

# Le spectre de la reproductibilité

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/reproducibility-spectrum.png" alt="Spectre de la reproductibilité," width="100%" /&gt;
&lt;p class="caption"&gt;Spectre de la reproductibilité,&lt;/p&gt;
&lt;/div&gt;
Source : ([Piazzi, Cerqueira, Manso, et al., 2018](#bib-piazzi)) 

---
# L'outillage


Aller de façon pragmatique vers une documentation accrue de ce que l'on fait (comment, pourquoi)

- Rendre accessible ses données à soir, aux partenaires, à tous) :
  - Data Managemlent Plan (Opidor)
  - Dépôt internationaux (ENA, NCBI)
  - DataVerse
- Définir les outils utilisés :
  - conda, bioconda
  - singularity, docker
  - Machine Virtuelle
- Décrire son workflow d'analyse, le rendre portable : 
  - Galaxy
  - Snakemake, Nextflow
- Gérer les versions de ses codes, les publier :
  - git
  - github / gitlab
- Tracer son analyse dans des documents partageables et réutilisables :
    - Rmd
    - Jupyter Notebooks

---
# Objectifs du TP
Décomplexifier les problème, se décomplexifier, désacraliser  la reproductibilité !

Vous fournir des outils, des pistes pour rendre vos projets :
- transparents
- robustes
- réutilisables
- partageables

Bref, *plus* reproductibles.


Parties pratiques sur la versionning des documents (Git et GitHub) et les docs computationnels.

---
class: inverse, center, middle
# Partie 1 : Organiser son espace de travail 

---
# Partie 1 : Organiser son espace de travail 
.pull-left[
![](https://journals.plos.org/ploscompbiol/article/figure/image?size=large&amp;id=info:doi/10.1371/journal.pcbi.1000424.g001)
Source : ([Noble, 2009](https://doi.org/10.1371/journal.pcbi.1000424))  

]

.pull-right[
Séparer 
- données
- code
- scripts
- résultats
]

---
# Organiser son espace de travail (2)

![](images/wilson-box1.png)

Source : ([Wilson, Bryan, Cranston, et al., 2017](https://doi.org/10.1371/journal.pcbi.1005510)) 


---
class: inverse, center, middle
# Partie 2 : Des langages à faible balisage pour faciliter la traçabilité et la prise de note

---
# Partie 2 : Des langages à faible balisage pour faciliter la traçabilité et la prise de note

*Comment mettre en forme et structurer simplement un document texte ?*  

--
&amp;rarr; avec un balisage faible tel que *Markdown* 

--

.pull-left[
- Permet :
  - Organiser les titres de sections
  - Italique / gras / souligné
  - Générer des listes
  - Ajouter des tableaux
  - Insertion d'image et de blocs de code

- Texte codé en UTF-8 (assure une pérennité, lisibilité et portabilité) facilement versionnable.
- Les langages de balisage permettent de mettre en forme convenablement le fichier pour un meilleur confort de lecture.

]

--

.pull-right[
_Exemple illustrant la simplification du balisage :_

- HTML


```bash
  &lt;ul&gt;
    &lt;li&gt;item1&lt;/li&gt;
    &lt;li&gt;item2&lt;/li&gt;
  &lt;/ul&gt;
```

- Markdown


```bash
  - item1
  - item2
```
  
]

---
# Partie 2 : Markdown - exemples de commande 

````
# Titre H1
## Sous-titre H2
### Sous-titre H3

*italique*, **gras** et `code`

&gt; Citations

```
bloc de code
```

* liste
  * item
  * item
  
[lien](https://fr.wikipedia.org)
![](https://migale.inrae.fr/sites/default/files/migale.png) #lien vers une image en ligne ou dans l'espace de travail
````

Gardez ce [mémo](https://guides.github.com/pdfs/markdown-cheatsheet-online.pdf) à porté de main !

---
class: inverse, center, middle
# Partie 3 : Versionner ses documents 

---
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/phd101212s.gif" alt="Piled Higher and Deeper by Jorge Cham. phdcomics" width="40%" /&gt;
&lt;p class="caption"&gt;Piled Higher and Deeper by Jorge Cham. phdcomics&lt;/p&gt;
&lt;/div&gt;

---
# Partie 3 : Versionner ses documents 

.pull-left[
- Les documents évoluent, il est nécéssaire de suivre les versions 
  - On trace toutes les modifications faites
  - On garde chaque version des documents du dossier de travail
  - C’est un peu comme copier-coller son dossier de travail … mais en beaucoup plus précis et pratique !
  - `git` est un standard dans la gestion des versions distribuée  
]

.pull-right[
![](images/commits.png)
]


Voici un [aide mémoire git](https://github.github.com/training-kit/downloads/fr/github-git-cheat-sheet.pdf)
---
# Vocabulaire
.pull-left[
Quelques mots à connaitre :
- **Repository** / **Dépôt** = Dossier / Projet 
- **Commit** = Enregistrement d’un ensemble de fichier à un instant T (= photo) 
- **Branche** = Ensemble chaîné de commits, par défaut la branche principale s’appelle « master » (cette notion n’est pas primordiale pour débuter) 



- **Git** : logiciel *open-souce*  de gestion de version de document. 
- **Github** : site web permettant de centraliser en ligne ses dépôts git et facilitant la collaboration sur les projets.
]

.pull-right[
&lt;img src="images/git-github.png" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]
---
# Retours sur les clés SSH

* Protocole pour la sécurisation des transferts de données.

* Méthode de chiffrement asymétrique qui fonctionne avec une paire de clé :
  * une clé *publique* qui sert à chiffrer (et que vous pouvez partager à l'extérieur)
  * une clé *privée* qui sert à déchiffrer (et que vous gardez précieusement secrète)

* Permet d'établir un tunnel sécurisé entre deux machines

---
class: center, middle
![](https://user.oc-static.com/files/145001_146000/145173.png)
---
class: center, middle
![](https://user.oc-static.com/files/145001_146000/145174.png)
---
class: center, middle
![](https://user.oc-static.com/files/145001_146000/145175.png)
---
class: center, middle
![](https://user.oc-static.com/files/145001_146000/145176.png)
---
class: center, middle
![](https://user.oc-static.com/files/145001_146000/145177.png)

---
# Retours sur les clés SSH

* Protocole pour la sécurisation des transferts de données.

* Méthode de chiffrement asymétrique qui fonctionne avec une paire de clé :
  * une clé *publique* qui sert à chiffrer (et que vous pouvez partager à l'extérieur)
  * une clé *privée* qui sert à déchiffrer (et que vous gardez précieusement secrète)

* Permet d'établir un tunnel sécurisé entre deux machines

*** 
* On utilise `ssh-keygen -t rsa` pour générer la paire de clé
* Puis `ssh-copy-id -i id_rsa.pub &lt;login&gt;@&lt;server&gt;` pour envoyer la clé publique
* Maintenant on peut se connecter de manière sécurisée via `ssh &lt;login&gt;@&lt;server&gt;` sans renseigner de clé
* Pour GitHub, on renseigne les clés publiques via l'interface graphique

---
# TP : Utilisation de Git  

## 1. Initialiser le dépôt (en local)

```
mkdir testRepo
cd testRepo
git init

```

--
```
vloux@jj-1404-port196 ~/tmp&gt; mkdir testRepo
vloux@jj-1404-port196 ~/tmp&gt; cd testRepo
vloux@jj-1404-port196 ~/tmp&gt; git init
Initialized empty Git repository in /Users/vloux/tmp/testRepo/.git/
```


---
# TP : Utilisation de Git  

## 2. Ajouter un document (en local)

```
echo 'my first line' &gt; firstFile

git status
```

--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; echo 'my first line' &gt; firstFile

vloux@jj-1404-port196 ~/t/testRepo&gt;   git status
On branch master

No commits yet

Untracked files:
  (use "git add &lt;file&gt;..." to include in what will be committed)
	firstFile

nothing added to commit but untracked files present (use "git add" to track)
```
---
# TP : Utilisation de Git  

## 3. Versionner un document (en local)

```
git add firstFile
git commit firstFile

git status
```

--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git add firstFile
vloux@jj-1404-port196 ~/t/testRepo&gt; git commit firstFile
[master (root-commit) 53e1cbc] first commit
 1 file changed, 1 insertion(+)
 create mode 100644 firstFile
vloux@jj-1404-port196 ~/t/testRepo&gt; git status
On branch master
nothing to commit, working tree clean
```
---
# TP : Utilisation de Git  

## 4. Workflow de modification (en local)
.pull-left[
```
echo 'seconde modif' &gt;&gt; firstFile

git status
git diff

git commit -m "ajout de la deuxième ligne" firstFile

```
]
--
.pull-right[
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git status
On branch master
Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)
	modified:   firstFile
vloux@jj-1404-port196 ~/t/testRepo&gt; git diff
diff --git a/firstFile b/firstFile
index b1a9f66..d491802 100644
--- a/firstFile
+++ b/firstFile
@@ -1 +1,2 @@
 my first line
+second modif
vloux@jj-1404-port196 ~/t/testRepo&gt; git commit -m "ajout de la deuxième ligne" firstFile
On branch master
[master b3a2b4c] ajout de la deuxième ligne
 1 file changed, 1 insertion(+)
```
]
---
# TP : Utilisation de GitHub

## 5. Initialisation du dépôt distant (Github)

- Créer un dépôt distant sur Github (1)

![](images/github-newrepo.png)
---
## 5. Initialisation du dépôt distant (Github)

.pull-left[
- Créer le dépôt distant sur Github
- Noter l'adresse du dépôt dans l'écran suivant.
&lt;img src="images/github-create-repo.png" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]
--
.pull-right[
&lt;img src="images/github-createrepo-2.png" width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]
---
# TP : Utilisation de GitHub
## 6. Lier le dépôt local et distant

- La commande `git remote` permet de lier notre dépôt à un dépôt distant, ici `test.git`
- Par convention, on appelle ce dépôt `origin`



```
git remote add origin git@github.com:vloux/test.git
git remote -v

```
--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git remote add origin git@github.com:vloux/test.git
vloux@jj-1404-port196 ~/t/testRepo&gt; git remote -v
origin	git@github.com:vloux/test.git (fetch)
origin	git@github.com:vloux/test.git (push)

```
---
# TP : Utilisation de GitHub
## 7. Pousser les modifications locales sur le dépôt distant

LA commande `push`pousse les modifications de la branche `master` (la branche par défaut locale) sur la branche `origin`(le nom de la branche distante). Le paramètre `-u` permet de créer la branche de reférence distante et de lier les branches disatntes et locales (et ainsi de se passer des arguments `origin` `master` par la suite)

```
git push origin master -u 
```
--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git push  origin master -u
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 8 threads
Compressing objects: 100% (2/2), done.
Writing objects: 100% (6/6), 489 bytes | 489.00 KiB/s, done.
Total 6 (delta 0), reused 0 (delta 0)
To github.com:vloux/test.git
 * [new branch]      master -&gt; master
Branch 'master' set up to track remote branch 'master' from 'origin'
```
---
# TP : Utilisation de GitHub

## 8. Verification sur Github des infos

- Connectez vous sur l'interface de Github :
  - trouvez votre dépôt
  - verifiez que vous trouvez bien le fichier que vous avez modifié, les commits

---
# TP : Utilisation de GitHub

## 9. Modification du dépôt par l'interface

- ajouter un `README.md` (avec markdown)
- le commiter depuis l'interface
- l'éditer

- commiter la modification

---
# TP : Utilisation de Git et GitHub

## 8. Récupérer sur le repo local des infos de la branche distante

.pull-left[
```
git fetch
git merge
```
équivalent à :
 
```
git pull
```
]

--

.pull-right[

```
vloux@jj-1404-port196 ~/t/testRepo&gt; git fetch
remote: Enumerating objects: 7, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (6/6), done.
From github.com:vloux/test
   b3a2b4c..c61dab3  master     -&gt; origin/master
vloux@jj-1404-port196 ~/t/testRepo&gt; git merge
Updating b3a2b4c..c61dab3
Fast-forward
 README.md | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
```
]

---
# TP : Utilisation de Git et GitHub

Nommer des versions (tags)

```
git tag version1 -m "Initial version"
 
git push  --tags

```
--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git tag version1 -m "Initial version"
version1
vloux@jj-1404-port196 ~/t/testRepo&gt;  git push  --tags
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), 171 bytes | 171.00 KiB/s, done.
Total 1 (delta 0), reused 0 (delta 0)
To github.com:vloux/tesRepository.git
 * [new tag]         version1 -&gt; version1
```
---
# TP : utilisation de Git et GitHub

Comparer à une version précédente

```
git log

git diff [CommitNumber] aNewFile

```

--
```
vloux@jj-1404-port196 ~/t/testRepo&gt; git diff 53e1cbcc5cab26f6c1550acd159ca30ad2acfeec firstFile
diff --git a/firstFile b/firstFile
index b1a9f66..d491802 100644
--- a/firstFile
+++ b/firstFile
@@ -1 +1,2 @@
 my first line
+second modif
```


---
# TP : utilisation de Git et GitHub. 
## Cloner un dépôt existant

- Dans le cas d'un dépôt distant existant, on peut directement le cloner en local. Il est lié au dépot distant et les modifications peuvenat ainis être récupérées ( `pull`) ou poussées ( `push`) sans avoir besoin de d'abord configurer les liens avec le dépôt distant.

```
git clone git@github.com:vloux/test.git

git remote -v


```

---
# En résumé 

- `git clone` : cloner un dépot distant
- `git init` : initialiser le versionning sur un dépot local
- `git commit` : enregister l'état d'un dépôt
- `git status` : afficher l'état des documents du dépôt
- `git diff` : comparer l'état actuel au dernier commit, ou deux commits entre eux ou deux branches 

et bien d'autres encore (``blame``, revert`,…)

[CheatSheet](https://github.github.com/training-kit/downloads/github-git-cheat-sheet.pdf)

---
# Pour apprendre progressivement et/ou se simplifier la vie

- Partir de d^pots que l'on crée sur Github et clone en local.

Utiliser une interface conviviale :
- Github Desktop
- Les intégration aux différents IDE (RStudio and co)

.center[
.pull-left[![github_desktop](https://desktop.github.com/images/desktop-icon.svg)]
.pull-right[![rstudio](https://upload.wikimedia.org/wikipedia/fr/4/4e/RStudio_Logo.png)]
]

---
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/github_desktop_1.png" alt="Cloner un dépot" width="80%" /&gt;
&lt;p class="caption"&gt;Cloner un dépot&lt;/p&gt;
&lt;/div&gt;
---
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/github_desktop_2.png" alt="Suivre les changements" width="80%" /&gt;
&lt;p class="caption"&gt;Suivre les changements&lt;/p&gt;
&lt;/div&gt;
---
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/github_desktop_3.png" alt="Parcourir l'historique des modifications" width="80%" /&gt;
&lt;p class="caption"&gt;Parcourir l'historique des modifications&lt;/p&gt;
&lt;/div&gt;
---
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/github_desktop_4.png" alt="Intéragir avec le Repository" width="80%" /&gt;
&lt;p class="caption"&gt;Intéragir avec le Repository&lt;/p&gt;
&lt;/div&gt;

---
class: center, middle

![coffee-break](https://www.nicepng.com/png/full/66-667402_coffee-break-logo-png.png)

---
class: inverse, center, middle
# Partie 4 : Documents computationels - Notebook

---
# Partie 4 : Documents computationels - Notebook

- Il faut se donner les moyens pour qu’autrui puisse inspecter nos analyses
- Expliciter pour augmenter les chances de trouver les erreurs et de les éliminer
  - Inspecter pour justifier et comprendre
  - Refaire pour vérifier, corriger et réutiliser

.center[![lab repro](https://blog.f1000.com/wp-content/uploads/2014/04/reproducibility-small-480x324.jpg)] 

---
# Partie 4 : Documents computationels - Notebook

- Regrouper dans *un unique document*: 
  - Les informations, le code, calculs et les résultats 
  - Pour assurer leur cohérence et améliorer la traçabilité. 
  - Exportable (ex : html) pour une meilleure portabilité et lisibilité.

.center[![russo2016](https://www.researchgate.net/profile/Dario_Righelli/publication/306538473/figure/fig2/AS:391153263366144@1470269613039/This-figure-explains-the-basic-idea-of-Reproducible-Research-The-raw-data-needs-to-be_W640.jpg)]

([Russo, Righelli, and Angelini, 2016](https://doi.org/10.1007/978-3-319-44332-4_19))

Encore un joli [mémo](https://www.rstudio.org/links/r_markdown_cheat_sheet) pour R markdown. 

Si vous travaillez principalement avec Python, il est possible de faire des notebook avec Jupyter.

---
# TP : Rédaction d'un notebook avec RStudio

1. Connectez vous au RStudio de l'IFB (https://rstudio.cluster.france-bioinformatique.fr/).
2. Clonez le projet :
  - New Project (en haut à droite)
  - Version Control
  - Git
  - Repository URL (clone with SSH : `git@github.com: ...`)
3. Explorez le dépot depuis ce 3e device remote 
4. Créez un document R Markdown :
  - File 
  - New file
  - R Markdown

**Dans ce document on a** :
- Une entête générale
- Du texte, mis en forme avec markdown
- Du code R dans des chunks
- Des résultats et outputs 

---

# TP : Rédaction d'un notebook avec RStudio 
* Grace à l'onglet git de Rstudio, vous pouvez suivre l'état des fichiers, commit, diff, push/pull, ...

* Chaque chunk peut être exécuté individuellement grâce à la flèche verte.  
Les options assosiées à chaque chunks sont disponible avec la roue crantée.

5. Modifier le document (en plusieurs commit)
  - ajoutez un chunk `knitr::kable(head(iris))` pour visualiser un table
  - ajoutez un chunk `plot(cars)` pour un plot
  - ajoutez des commentaires
  - puis commitez les modifications.
6. Lorsque vous êtes satisfait de votre raport, générez la version HTML en cliquant sur Knit. Commitez, pushez, ...
7. Visualisez les modifications côté GitHub.

**Votre rapport est disponible, versionné et partageable !**

---
# TP : Partager un document html avec GitHub Pages

* Dans les options du repo, dans le chapitre "GitHub Pages", activer la source correspondant à la branch master.
* la page est disponible à l'adresse [https://[user].github.io/[repo]/[page].html](https://cedricmidoux.github.io/cookies/notebook.html)

Suivant l'interlocuteur, partagez le `.Rmd` ou le `.html`

---
# Conclusion : 

La reprouctibilité, comme la "FAIRisation" sont des processus.

Des bonnes pratiques appuyées par des outils qui les facilitent

- Organiser ses analyses
- Décruire correctement ses données et ses processus d'analyse (PGD, FAIR)
- Tracer ses analyses à l'aide de documents computationnels (Rmd, Jupyter Notebooks, …) :
  - Transparents 
  - Accessibles
  - Partageables
- Versionner ses documents computationnels (GitHub, GitLab, …)
  - Traçabilité
  - Accessibilité

---
# Aller plus loin - travailler en commun avec Git et Github :

.center[![Github Flow](images/github-flow.png)] 


- Branche : version parallèle à la version principale
- Pull Request : demande de fusion des modifications d'une brache vers la branche principale

[Un exemple de PR](https://github.com/galaxyproject/training-material/pull/1354) 


---
# Pour aller + loin - Fixer et partager son environnement :

.pull-left[
- Conda et  Bioconda 
  - gestion des dépendances, versions
  - Possibilité de créer un environnement par analyse
  - Exporter son environnement dans un fichier ``env.yml`` et le versionner
  - ``conda env export &gt; environment.yml``
  
- Containers,  machines virtuelles
  - Docker, Singularity, VM virtualbox
  - Pour les outils non "condaoisables", les environnements complexes
  - Les images Singularity sont déployables sur les infrastructures type IFB et s'éxecutent "presque" comme un executable
]

.pull-right[
.center[![Conda](https://conda.io/en/latest/_images/conda_logo.svg)]
.center[![Singularity](https://sylabs.io/assets/images/logos/singularity.png)]


]

---
# Pour aller plus loin - Fixer et partager son environnement (2) 
.center[![Singularity](https://ars.els-cdn.com/content/image/1-s2.0-S2405471218301406-gr1.jpg)]

([Grüning, Chilton, Köster, et al., 2018](https://doi.org/10.1016/j.cels.2018.03.014)) 

---
# Pour aller + loin - gestionnaires de workflows

SnakeMake, NextFlow pour :
- Définir de façon "simple" et modulaire des workflows d'analyse :
  - Parallelisables : les étapes indépendantes peuvent être jouées en parallèle.
  - Qui assurent la reprise sur erreur : si on refait une analyse, change un paramètre, seul ce qui doit être rejoué est relancé.
  - Portables : un même script peut être joué en local, sur des  clusters différents en changeant le fichier de configuration.
  - Partageables : un fichier texte versionné
  - Peut gérer pour vous le versionning et l'installation des outils avec Conda



---
# Pour aller + loin - exemple de Snakefile

**Bash**

```
 for sample in `ls *.fastq.gz` do
  fastqc ${sample}
done
```

--

**Snakefile**

```
SAMPLES, = glob_wildcards("./{smp}.fastq.gz")

rule final: 
  input:expand("fastqc/{smp}/{smp}_fastqc.zip",smp=SAMPLES)
rule fastqc:
  input: "{smp}.fastq.gz"
  output: "fastqc/{smp}/{smp}_fastqc.zip"
  message: """Quality check"""
  shell: """fastqc {input} --outdir fastqc/{wildcards.smp}"""
```

---
# Pour aller + loin - FAIRifier ses données
Dépots dans les dépôts publics :
- Dans les dépôts thématiques internationaux (européens !)  
    - données brutes 
    - données analysées
    - /!\ méta-données
- dans les dépots généralistes (dataverse , figshare, …)
  - fichiers tabulés; "autres" données. ce qu'on mettrait en suypplementary material.
  - (éventuels) leins vers les fichiers de données

- Publier un data-paper ?



---
# Pour aller + loin :
.pull-left[
- jusqu'où aller dans la reproductibilité ?
  - Mat et Met électroniques :
    - Galaxy Pages
    - Gigascience, GigaDB : 
      - "GigaScience aims to revolutionize publishing by promoting reproducibility of analyses and data dissemination, organization, understanding, and use. "

]
.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/galaxy-pages.png" alt="Live Mat et Met https://usegalaxy.org/u/aun1/p/windshield-splatter" width="80%" /&gt;
&lt;p class="caption"&gt;Live Mat et Met https://usegalaxy.org/u/aun1/p/windshield-splatter&lt;/p&gt;
&lt;/div&gt;

Au final, toujours se poser la question du rapport coût / bénéfice.
]



---

# Ressources

- [FUN MOOC Recherche Reproductible](https://www.fun-mooc.fr/courses/course-v1:inria+41016+self-paced/about)
- [FAIR Bioinfo](https://github.com/thomasdenecker/FAIR_Bioinfo)
- [Cours Git et Github](https://guides.github.com)
- [Github pages](https://pages.github.com)
- [Rmd the definitive Guide](https://bookdown.org/yihui/rmarkdown/)
- [Snakemake](https://snakemake.readthedocs.io/en/stable/)
- [NextFlow](https://www.nextflow.io) et [nf-core](https://nf-co.re)
- 

- Les mémo présentés dans ce cours :
  - [markdown](https://guides.github.com/pdfs/markdown-cheatsheet-online.pdf)
  - [git](https://github.github.com/training-kit/downloads/fr/github-git-cheat-sheet.pdf)
  - [R markdown](https://www.rstudio.org/links/r_markdown_cheat_sheet)

---

# References

&lt;a name=bib-allard&gt;&lt;/a&gt;[Allard, A.](#cite-allard) (2018). _La crise de la réplicabilité_. URL:
[https://laviedesidees.fr/La-crise-de-la-replicabilite.html](https://laviedesidees.fr/La-crise-de-la-replicabilite.html).

&lt;a name=bib-Baker2016&gt;&lt;/a&gt;[Baker, M.](#cite-Baker2016) (2016). "1, 500 scientists lift the lid on reproducibility". In: _Nature_
533.7604, pp. 452-454. DOI: [10.1038/533452a](https://doi.org/10.1038%2F533452a). URL:
[https://doi.org/10.1038/533452a](https://doi.org/10.1038/533452a).

&lt;a name=bib-Bjorn2018&gt;&lt;/a&gt;[Grüning, B, J. Chilton, J. Köster, et al.](#cite-Bjorn2018) (2018). "Practical Computational
Reproducibility in the Life Sciences". In: _Cell Systems_ 6.6, pp. 631-635. DOI:
[10.1016/j.cels.2018.03.014](https://doi.org/10.1016%2Fj.cels.2018.03.014). URL:
[https://doi.org/10.1016/j.cels.2018.03.014](https://doi.org/10.1016/j.cels.2018.03.014).

&lt;a name=bib-noble&gt;&lt;/a&gt;[Noble, W. S.](#cite-noble) (2009). "A Quick Guide to Organizing Computational Biology Projects". In: _PLOS
Computational Biology_ 5.7, pp. 1-5. DOI: [10.1371/journal.pcbi.1000424](https://doi.org/10.1371%2Fjournal.pcbi.1000424). URL:
[https://doi.org/10.1371/journal.pcbi.1000424](https://doi.org/10.1371/journal.pcbi.1000424).

&lt;a name=bib-piazzi&gt;&lt;/a&gt;[Piazzi, A. C, A. S. Cerqueira, L. R. Manso, et al.](#cite-piazzi) (2018). "Reproducible research platform for
electric power quality algorithms" , pp. 1-6.

&lt;a name=bib-russo&gt;&lt;/a&gt;[Russo, F., D. Righelli, and C. Angelini](#cite-russo) (2016). "Advantages and Limits in the Adoption of
Reproducible Research and R-Tools for the Analysis of Omic Data". In: Vol. 9874. , pp. 245-258. DOI:
[10.1007/978-3-319-44332-4_19](https://doi.org/10.1007%2F978-3-319-44332-4_19).

&lt;a name=bib-Wilkinson2016&gt;&lt;/a&gt;[Wilkinson, M. D, M. Dumontier, I. J. Aalbersberg, et al.](#cite-Wilkinson2016) (2016). "The FAIR
Guiding Principles for scientific data management and stewardship". In: _Scientific Data_ 3.1. DOI:
[10.1038/sdata.2016.18](https://doi.org/10.1038%2Fsdata.2016.18). URL:
[https://doi.org/10.1038/sdata.2016.18](https://doi.org/10.1038/sdata.2016.18).

&lt;a name=bib-Wilson&gt;&lt;/a&gt;[Wilson, G, J. Bryan, K. Cranston, et al.](#cite-Wilson) (2017). "Good enough practices in scientific
computing". In: _PLOS Computational Biology_ 13, pp. 1-20. DOI:
[10.1371/journal.pcbi.1005510](https://doi.org/10.1371%2Fjournal.pcbi.1005510). URL:
[https://doi.org/10.1371/journal.pcbi.1005510](https://doi.org/10.1371/journal.pcbi.1005510).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
